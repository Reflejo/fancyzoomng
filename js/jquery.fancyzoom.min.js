jQuery.fn.fancyHide=function(){$('#zoom_close').click()};jQuery.fn.fancyZoom=function(a){var a=a||{};var l=a.directory||'images';var f=false;if($('#zoom').length==0){var n=$.browser.msie?'gif':'png';var g=l+'/box.'+n;var o=l+'/sides.'+n;var x='<div id="zoom" style="display: none; z-index: 10"><table id="zoom_table" style="border-collapse:collapse; width:100%; height:100%;"><tbody><tr><td style="background:url('+g+') 0 0 no-repeat; width:26px; height:26px; overflow:hidden;"></td><td style="background:url('+g+') 0 -52px repeat-x; height:26px; overflow:hidden;"></td><td style="background:url('+g+') 0 -110px no-repeat; width:26px; height:26px; overflow:hidden;"></td></tr><tr><td style="background:url('+o+') 0 0 repeat-y; width:26px; overflow:hidden;"></td><td style="background:#fff; vertical-align:top; padding:10px;"><div id="zoom_content"></div></td><td style="background:url('+o+') -28px 0 repeat-y;  width:26px; overflow:hidden;"></td></tr><tr><td style="background:url('+g+') 0 -26px no-repeat; width:26px; height:26px; overflow:hidden;"></td><td style="background:url('+g+') 0 -78px repeat-x; height:26px; overflow:hidden;"></td><td style="background:url('+g+') 0 -136px no-repeat; width:26px; height:20px; overflow:hidden;"></td></tr></tbody></table><a href="#" title="Close" id="zoom_close" style="position:absolute; top:0px; left:0px;"><img src="'+l+'/closebox.png" alt="Close" style="border:none; margin:0; padding:0;"></td></a></div>';$('body').append(x);$('html').click(function(d){if(!$(d.target).hasClass('zoomed')&&$('#zoom:visible').length&&!$(d.target).parents('#zoom').length)k()});$(document).keyup(function(d){if(d.keyCode==27&&$('#zoom:visible').length>0)k()});$('#zoom_close').click(k)}var C=$('#zoom');var D=$('#zoom_table');var b=$('#zoom_close');var e=$('#zoom_content');var E=$('td.ml,td.mm,td.mr');var p=function(c){$('#zoom_table td').each(function(d){var j=$(this).css('background-image').replace(/\.(png|gif|none)\"\)$/,'.'+c+'")');$(this).css('background-image',j)});var h=b.children('img');var i=h.attr('src').replace(/\.(png|gif|none)$/,'.'+c);h.attr('src',i)};var q=function(){if($.browser.msie&&parseFloat($.browser.version)>=7){p('gif')}};var r=function(){if($.browser.msie&&$.browser.version>=7){p('png')}};function y(j,c){if(f||$('#zoom:visible').length)return false;f=true;var h=$('<div id="dimmer" style="position:absolute;top:0px"/>').height(Math.max($('body').height(),$(document).height()));var i=window.document;var z=window.pageXOffset||(i.documentElement.scrollLeft||i.body.scrollLeft);var s=window.pageYOffset||(i.documentElement.scrollTop||i.body.scrollTop);var t={'width':$(window).width(),'height':$(window).height(),'x':z,'y':s};var u=parseInt(a.width||c.width())+60;var m=parseInt(a.height||c.height())+60;e.height(m-120);var A=Math.max((t.height/2)-(m/2)+s,0);var B=(t.width/2)-(u/2);var v=j.pageY;var w=j.pageX;b.attr('curTop',v);b.attr('curLeft',w);b.attr('scaleImg',Boolean(a.scaleImg));$('#zoom').hide().css({position:'absolute',top:v+'px',left:w+'px',width:'1px',height:'1px'});q();b.hide();if(a.closeOnClick){$('#zoom').click(k)}if(a.scaleImg){e.html(c.html());$('#zoom_content img').css('width','100%')}else{e.empty()}$('body').append(h);$('#zoom').animate({top:A+'px',left:B+'px',opacity:"show",width:u,height:m},500,null,function(){if(!a.scaleImg){if(a.url){if(!$("#zoom_indicator").length)e.append($('<div id="zoom_indicator"/>'));$.ajax({url:a.url,success:function(d){e.html(d)}})}else{e.html(c.html())}}r();b.show();f=false});return false}function k(){if(f)return false;f=true;$('#dimmer').remove();$('#zoom').unbind('click');q();if(b.attr('scaleImg')!='true'){e.empty()}b.hide();$('#zoom').animate({top:b.attr('curTop')+'px',left:b.attr('curLeft')+'px',opacity:"hide",width:'1px',height:'1px'},500,null,function(){if(b.attr('scaleImg')=='true'){e.empty()}r();f=false});return false}this.each(function(j,c){var h=$(a.modal||$(c).attr('href')).hide();$(c).addClass('zoomed');$(c).click(function(d){y(d,h)})});return this}
